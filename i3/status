#!/usr/bin/env python3

import datetime
from pathlib import Path
import argparse
from utils import calculate_cpu_usage, calculate_memory_usage

import i3ipc


parser = argparse.ArgumentParser()
parser.add_argument('--toggle', action='store_true')
args = parser.parse_args()

i3_hide_time_fn = Path('/tmp/i3_hide_time')

if args.toggle:
    if i3_hide_time_fn.exists():
        i3_hide_time_fn.unlink()
    else:
        i3_hide_time_fn.touch()

i3 = i3ipc.Connection()
num_scratchpad = len(i3.get_tree().scratchpad().leaves())

if num_scratchpad > 0:
    print('ğŸ“', num_scratchpad, end=' | ')

cpu_usage = calculate_cpu_usage()
print('ğŸ”²', cpu_usage, end='% | ')

if i3_hide_time_fn.exists():
    str_fr_time = 'ğŸ—“ï¸ %F'
else:
    str_fr_time = 'ğŸ—“ï¸ %F | ğŸ•’ %R'

mem_usage, total, used, available = calculate_memory_usage()
# used_gb = used / 1024 / 1024
# total_gb = total / 1024 / 1024
usage_str = str(int(round(mem_usage))).rjust(2)
# print(f'ğŸ’¾ {used_gb:.1f}/{total_gb:.1f} ({usage_str}%)', end=' | ')
print(f'ğŸ’¾ {usage_str}%', end=' | ')

print(datetime.datetime.now().strftime(str_fr_time), end=' | ')
